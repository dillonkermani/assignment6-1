[[extend 'layout.html']]

<div id="app">
  <div class="section">
      <div class="container">
          <h1 class="title">Contact Requests</h1>
          <div class="field">
              <div class="control">
                  <input id="nameSearch" class="search-input" type="text" placeholder="Search by Name">
              </div>
          </div>
          <div class="field">
              <div class="control">
                  <input id="messageSearch" class="search-input" type="text" placeholder="Search by Message">
              </div>
          </div>

          <table class="table is-fullwidth">
              <thead>
                  <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Message</th>
                  </tr>
              </thead>
              <tbody id="requestsTable">
                  <!-- Rows will be added here by JavaScript -->
              </tbody>
          </table>
      </div>
  </div>
</div>

[[block page_scripts]]

<script>
let contact_requests_url = "[[=XML(contact_requests_url)]]";

document.getElementById('nameSearch').addEventListener('input', updateSearch);
document.getElementById('messageSearch').addEventListener('input', updateSearch);

function updateSearch() {
  const nameSearch = document.getElementById('nameSearch').value;
  const messageSearch = document.getElementById('messageSearch').value;

  axios.get(contact_requests_url, {
    params: {
      nameSearch: nameSearch,
      messageSearch: messageSearch
    }
  })
  .then(response => {
    const requestsTable = document.getElementById('requestsTable');
    requestsTable.innerHTML = '';
    response.data.forEach(request => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${request.name}</td>
        <td>${request.email}</td>
        <td>${request.phone}</td>
        <td>${request.message}</td>
      `;
      requestsTable.appendChild(row);
    });
  });
}

updateSearch();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js"></script>
<script src="js/index.js"></script>
[[end]]